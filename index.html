<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>リアル逆転裁判 — 三審制（スマホ対応）</title>

<!-- Google Fonts: 日本語対応 -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

<style>
  body { font-family:"Noto Sans JP",sans-serif; margin:0; padding:10px; background:#f6f8fb; }
  h1 { font-size:1.2em; text-align:center; color:#1a73e8; }
  .card { background:#fff; border-radius:12px; padding:12px; margin:10px 0; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
  button { width:100%; padding:12px; font-size:1em; margin:5px 0; border-radius:8px; border:none; background:#1a73e8; color:#fff; }
  button:hover { background:#0d5bcc; }
  textarea { width:100%; padding:8px; border-radius:8px; border:1px solid #ddd; }
  #log { height:200px; overflow-y:auto; padding:8px; border:1px solid #ccc; border-radius:8px; background:#fff; white-space:pre-wrap; }
  @media (prefers-color-scheme: dark) {
    body { background:#0b1220; color:#eee; }
    .card { background:#1c1f2e; }
    #log { background:#111; color:#eee; border-color:#333; }
  }
</style>
</head>
<body>
<h1>⚖️ リアル逆転裁判（三審制）</h1>

<div class="card">
  <label>事件概要:</label>
  <textarea id="caseInput" rows="3" placeholder="事件内容を入力してください"></textarea>
  <button onclick="generateCase()">🎲 ランダム事件を生成</button>
  <button onclick="startTrial()">⚔️ 裁判開始</button>
</div>

<div class="card">
  <button onclick="makePrediction('plaintiff')">📌 原告勝訴を予想</button>
  <button onclick="makePrediction('defendant')">📌 被告勝訴を予想</button>
  <button onclick="raiseObjection()">🙋 異議あり！</button>
  <textarea id="playerOpinion" rows="2" placeholder="自由意見を入力"></textarea>
  <button onclick="saveOpinion()">📝 意見を記録</button>
</div>

<div class="card">
  <h3>裁判ログ</h3>
  <div id="log"></div>
</div>

<div class="card">
  <button onclick="nextStage()">➡️ 次の審級へ進む</button>
  <button onclick="exportPDF()">📄 判決PDFを出力</button>
</div>

<!-- html2pdf (日本語もOK) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
let stage = 0;
let caseData = {};
let verdicts = {};
let predictions = {};
let actions = [];

function $(id){return document.getElementById(id);}
function log(msg){$("log").innerText += msg + "\\n"; $("log").scrollTop = $("log").scrollHeight;}

// 事件自動生成
function generateCase(){
  const cases = [
    "自転車と歩行者の衝突事故 — 損害賠償請求",
    "飲酒運転による交通事故 — 刑事事件",
    "建築確認取消訴訟 — 行政事件"
  ];
  $("caseInput").value = cases[Math.floor(Math.random()*cases.length)];
}

// 裁判開始
function startTrial(){
  if(!$("caseInput").value.trim()){ alert("事件概要を入力してください"); return; }
  caseData = { title:$("caseInput").value, id:Date.now() };
  stage = 1;
  log("=== 第一審開始 ===");
  simulateStage();
}

// 次の審級へ
function nextStage(){
  if(stage===0){ alert("裁判が始まっていません"); return; }
  if(stage>=3){ alert("最高裁まで終了しました"); return; }
  stage++;
  log("=== 第"+stage+"審開始 ===");
  simulateStage();
}

// シミュレーション
function simulateStage(){
  const court = stage===1?"地方裁判所":stage===2?"高等裁判所":"最高裁判所";
  const winner = Math.random()>0.5?"plaintiff":"defendant";
  const headline = winner==="plaintiff"?"原告勝訴":"被告勝訴";
  const full = `${court} 判決文（要旨）:\\n事件: ${caseData.title}\\n主文: ${headline}`;
  verdicts[stage] = {winner, text:full};
  log(full);
  if(predictions[stage]){
    log("あなたの予想: "+(predictions[stage]==="plaintiff"?"原告勝訴":"被告勝訴")+
        " → "+(predictions[stage]===winner?"的中！":"外れ…"));
  }
}

// 予想登録
function makePrediction(who){
  if(stage===0){ alert("まず裁判を開始してください"); return; }
  predictions[stage] = who;
  log("予想を登録: "+(who==="plaintiff"?"原告勝訴":"被告勝訴"));
}

// 異議あり
function raiseObjection(){
  if(stage===0){ alert("まだ裁判が始まっていません"); return; }
  const t = prompt("異議内容を入力:");
  if(t){ actions.push({stage,type:"objection",text:t}); log("異議あり: "+t); }
}

// 意見保存
function saveOpinion(){
  if(stage===0){ alert("まだ裁判が始まっていません"); return; }
  const t = $("playerOpinion").value.trim();
  if(t){ actions.push({stage,type:"opinion",text:t}); log("意見: "+t); $("playerOpinion").value=""; }
}

// PDF出力
function exportPDF(){
  const wrapper = document.createElement("div");
  wrapper.innerHTML = `<h2>判決書（シミュレーション）</h2>
    <p><strong>事件:</strong> ${caseData.title}</p>`;
  for(let s=1;s<=3;s++){
    if(verdicts[s]){
      wrapper.innerHTML += `<h3>第${s}審</h3><pre>${verdicts[s].text}</pre>`;
      wrapper.innerHTML += `<p>あなたの予想: ${predictions[s]? (predictions[s]==="plaintiff"?"原告勝訴":"被告勝訴"):"未登録"}</p>`;
      const acts = actions.filter(a=>a.stage===s);
      if(acts.length){
        wrapper.innerHTML += "<ul>"+acts.map(a=>`<li>[${a.type}] ${a.text}</li>`).join("")+"</ul>";
      }
    }
  }
  html2pdf().from(wrapper).save("判決文.pdf");
}
</script>
</body>
</html>
