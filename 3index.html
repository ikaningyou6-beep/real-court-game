<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ãƒªã‚¢ãƒ«é€†è»¢è£åˆ¤ â€” ä¸‰å¯©åˆ¶ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰</title>

<!-- Google Fonts: æ—¥æœ¬èªå¯¾å¿œ -->
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">

<style>
  body { font-family:"Noto Sans JP",sans-serif; margin:0; padding:10px; background:#f6f8fb; }
  h1 { font-size:1.2em; text-align:center; color:#1a73e8; }
  .card { background:#fff; border-radius:12px; padding:12px; margin:10px 0; box-shadow:0 4px 10px rgba(0,0,0,0.05); }
  button { width:100%; padding:12px; font-size:1em; margin:5px 0; border-radius:8px; border:none; background:#1a73e8; color:#fff; }
  button:hover { background:#0d5bcc; }
  textarea { width:100%; padding:8px; border-radius:8px; border:1px solid #ddd; }
  #log { height:200px; overflow-y:auto; padding:8px; border:1px solid #ccc; border-radius:8px; background:#fff; white-space:pre-wrap; }
  @media (prefers-color-scheme: dark) {
    body { background:#0b1220; color:#eee; }
    .card { background:#1c1f2e; }
    #log { background:#111; color:#eee; border-color:#333; }
  }
</style>
</head>
<body>
<h1>âš–ï¸ ãƒªã‚¢ãƒ«é€†è»¢è£åˆ¤ï¼ˆä¸‰å¯©åˆ¶ï¼‰</h1>

<div class="card">
  <label>äº‹ä»¶æ¦‚è¦:</label>
  <textarea id="caseInput" rows="3" placeholder="äº‹ä»¶å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
  <button onclick="generateCase()">ğŸ² ãƒ©ãƒ³ãƒ€ãƒ äº‹ä»¶ã‚’ç”Ÿæˆ</button>
  <button onclick="startTrial()">âš”ï¸ è£åˆ¤é–‹å§‹</button>
</div>

<div class="card">
  <button onclick="makePrediction('plaintiff')">ğŸ“Œ åŸå‘Šå‹è¨´ã‚’äºˆæƒ³</button>
  <button onclick="makePrediction('defendant')">ğŸ“Œ è¢«å‘Šå‹è¨´ã‚’äºˆæƒ³</button>
  <button onclick="raiseObjection()">ğŸ™‹ ç•°è­°ã‚ã‚Šï¼</button>
  <textarea id="playerOpinion" rows="2" placeholder="è‡ªç”±æ„è¦‹ã‚’å…¥åŠ›"></textarea>
  <button onclick="saveOpinion()">ğŸ“ æ„è¦‹ã‚’è¨˜éŒ²</button>
</div>

<div class="card">
  <h3>è£åˆ¤ãƒ­ã‚°</h3>
  <div id="log"></div>
</div>

<div class="card">
  <button onclick="nextStage()">â¡ï¸ æ¬¡ã®å¯©ç´šã¸é€²ã‚€</button>
  <button onclick="exportPDF()">ğŸ“„ åˆ¤æ±ºPDFã‚’å‡ºåŠ›</button>
</div>

<!-- html2pdf (æ—¥æœ¬èªã‚‚OK) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
let stage = 0;
let caseData = {};
let verdicts = {};
let predictions = {};
let actions = [];

function $(id){return document.getElementById(id);}
function log(msg){$("log").innerText += msg + "\\n"; $("log").scrollTop = $("log").scrollHeight;}

// äº‹ä»¶è‡ªå‹•ç”Ÿæˆ
function generateCase(){
  const cases = [
    "è‡ªè»¢è»Šã¨æ­©è¡Œè€…ã®è¡çªäº‹æ•… â€” æå®³è³ å„Ÿè«‹æ±‚",
    "é£²é…’é‹è»¢ã«ã‚ˆã‚‹äº¤é€šäº‹æ•… â€” åˆ‘äº‹äº‹ä»¶",
    "å»ºç¯‰ç¢ºèªå–æ¶ˆè¨´è¨Ÿ â€” è¡Œæ”¿äº‹ä»¶"
  ];
  $("caseInput").value = cases[Math.floor(Math.random()*cases.length)];
}

// è£åˆ¤é–‹å§‹
function startTrial(){
  if(!$("caseInput").value.trim()){ alert("äº‹ä»¶æ¦‚è¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
  caseData = { title:$("caseInput").value, id:Date.now() };
  stage = 1;
  log("=== ç¬¬ä¸€å¯©é–‹å§‹ ===");
  simulateStage();
}

// æ¬¡ã®å¯©ç´šã¸
function nextStage(){
  if(stage===0){ alert("è£åˆ¤ãŒå§‹ã¾ã£ã¦ã„ã¾ã›ã‚“"); return; }
  if(stage>=3){ alert("æœ€é«˜è£ã¾ã§çµ‚äº†ã—ã¾ã—ãŸ"); return; }
  stage++;
  log("=== ç¬¬"+stage+"å¯©é–‹å§‹ ===");
  simulateStage();
}

// ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
function simulateStage(){
  const court = stage===1?"åœ°æ–¹è£åˆ¤æ‰€":stage===2?"é«˜ç­‰è£åˆ¤æ‰€":"æœ€é«˜è£åˆ¤æ‰€";
  const winner = Math.random()>0.5?"plaintiff":"defendant";
  const headline = winner==="plaintiff"?"åŸå‘Šå‹è¨´":"è¢«å‘Šå‹è¨´";
  const full = `${court} åˆ¤æ±ºæ–‡ï¼ˆè¦æ—¨ï¼‰:\\näº‹ä»¶: ${caseData.title}\\nä¸»æ–‡: ${headline}`;
  verdicts[stage] = {winner, text:full};
  log(full);
  if(predictions[stage]){
    log("ã‚ãªãŸã®äºˆæƒ³: "+(predictions[stage]==="plaintiff"?"åŸå‘Šå‹è¨´":"è¢«å‘Šå‹è¨´")+
        " â†’ "+(predictions[stage]===winner?"çš„ä¸­ï¼":"å¤–ã‚Œâ€¦"));
  }
}

// äºˆæƒ³ç™»éŒ²
function makePrediction(who){
  if(stage===0){ alert("ã¾ãšè£åˆ¤ã‚’é–‹å§‹ã—ã¦ãã ã•ã„"); return; }
  predictions[stage] = who;
  log("äºˆæƒ³ã‚’ç™»éŒ²: "+(who==="plaintiff"?"åŸå‘Šå‹è¨´":"è¢«å‘Šå‹è¨´"));
}

// ç•°è­°ã‚ã‚Š
function raiseObjection(){
  if(stage===0){ alert("ã¾ã è£åˆ¤ãŒå§‹ã¾ã£ã¦ã„ã¾ã›ã‚“"); return; }
  const t = prompt("ç•°è­°å†…å®¹ã‚’å…¥åŠ›:");
  if(t){ actions.push({stage,type:"objection",text:t}); log("ç•°è­°ã‚ã‚Š: "+t); }
}

// æ„è¦‹ä¿å­˜
function saveOpinion(){
  if(stage===0){ alert("ã¾ã è£åˆ¤ãŒå§‹ã¾ã£ã¦ã„ã¾ã›ã‚“"); return; }
  const t = $("playerOpinion").value.trim();
  if(t){ actions.push({stage,type:"opinion",text:t}); log("æ„è¦‹: "+t); $("playerOpinion").value=""; }
}

// PDFå‡ºåŠ›
function exportPDF(){
  const wrapper = document.createElement("div");
  wrapper.innerHTML = `<h2>åˆ¤æ±ºæ›¸ï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰</h2>
    <p><strong>äº‹ä»¶:</strong> ${caseData.title}</p>`;
  for(let s=1;s<=3;s++){
    if(verdicts[s]){
      wrapper.innerHTML += `<h3>ç¬¬${s}å¯©</h3><pre>${verdicts[s].text}</pre>`;
      wrapper.innerHTML += `<p>ã‚ãªãŸã®äºˆæƒ³: ${predictions[s]? (predictions[s]==="plaintiff"?"åŸå‘Šå‹è¨´":"è¢«å‘Šå‹è¨´"):"æœªç™»éŒ²"}</p>`;
      const acts = actions.filter(a=>a.stage===s);
      if(acts.length){
        wrapper.innerHTML += "<ul>"+acts.map(a=>`<li>[${a.type}] ${a.text}</li>`).join("")+"</ul>";
      }
    }
  }
  html2pdf().from(wrapper).save("åˆ¤æ±ºæ–‡.pdf");
}
</script>
</body>
</html>
